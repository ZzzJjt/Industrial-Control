PROGRAM CascadeControl_HeatExchanger
VAR
    // Outer loop: temperature control
    Temp_SP     : REAL := 85.0;    // Desired outlet temperature in Â°C
    Temp_PV     : REAL;            // Measured outlet temperature
    Temp_Error  : REAL;            // Temp control error
    Flow_SP     : REAL;            // Flow rate setpoint generated by outer loop

    // Inner loop: flow control
    Flow_PV     : REAL;            // Actual flow rate
    Flow_Error  : REAL;            // Flow control error
    Flow_Output : REAL;            // Output signal to flow control valve

    // Controller tuning parameters
    Kp_Outer    : REAL := 1.0;     // Proportional gain for outer loop
    Kp_Inner    : REAL := 2.0;     // Proportional gain for inner loop
END_VAR

// --- Outer Loop: Temperature Control ---
// Calculates flow setpoint to achieve target outlet temperature
Temp_Error := Temp_SP - Temp_PV;           // Compute temperature error
Flow_SP := Kp_Outer * Temp_Error;          // Adjust flow setpoint based on temp error

// --- Inner Loop: Flow Control ---
// Controls the heating medium flow rate based on Flow_SP
Flow_Error := Flow_SP - Flow_PV;           // Compute flow error
Flow_Output := Kp_Inner * Flow_Error;      // Valve signal to adjust flow

// --- Output ---
// Flow_Output should be sent to actuator (e.g., analog output to valve)
// Clamp or limit logic can be added if needed for safety
