FUNCTION_BLOCK MotorController
  EVENT_INPUT   START, STOP
  EVENT_OUTPUT  CONFIRM

  VAR_INPUT
    ENABLE : BOOL;
  END_VAR

  VAR_OUTPUT
    MOTOR_ON : BOOL;
  END_VAR
END_FUNCTION_BLOCK

// STATES
STATE INIT :
  MOTOR_ON := FALSE;
  IF START THEN
    TRANSITION TO STARTING;
  END_IF;

STATE STARTING :
  IF ENABLE THEN
    MOTOR_ON := TRUE;
    EMIT CONFIRM;
    TRANSITION TO RUNNING;
  ELSE
    TRANSITION TO INIT;
  END_IF;

STATE RUNNING :
  IF STOP THEN
    TRANSITION TO STOPPING;
  END_IF;

STATE STOPPING :
  MOTOR_ON := FALSE;
  EMIT CONFIRM;
  TRANSITION TO INIT;

  ALGORITHM INIT_ALG
  MOTOR_ON := FALSE;
END_ALGORITHM

ALGORITHM START_ALG
  IF ENABLE THEN
    MOTOR_ON := TRUE;
  END_IF;
END_ALGORITHM

ALGORITHM STOP_ALG
  MOTOR_ON := FALSE;
END_ALGORITHM

